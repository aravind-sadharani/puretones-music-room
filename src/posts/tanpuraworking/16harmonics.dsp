import("stdfaust.lib");

commonPitch = hslider("[0][style:radio{'B':14;'A#':13;'A':12;'G#':11;'G':10;'F#':9;'F':8;'E':7;'D#':6;'D':5;'C#':4;'C':3}]Pitch",3,3,14,1);
fineTune = hslider("Fine_Tune",0,-100,100,1);
cperiod = 2^(vslider("[01]Motif Tempo",1.0,-2,4,0.1) - 3);
cgain = 10^(vslider("[02]Motif Gain",0,-20,20,0.1) - 6 : /(20)) : /(sqrt(_voice_1noteratio));
delta = vslider("[04]Shake Variance", 10,0,120,1);  	
rate = vslider("[05]Shake Rate",11.5,10,25,0.1);
c2v(d) = 2^(d/1200)-1;
l2l(r) = 2^(r/10);
number = vslider("[06]Shake Number",3.4,1,10,0.1);
phasor(f) = ba.period(ma.SR/f) : *(f/ma.SR);
ramp(x) = ba.time : *(x);

fullstring(f,n1,n2,g) = ((g^(n2+2-n1))*os.osc(f*n2) + os.osc(f*n1) - (g^(n2+1-n1))*os.osc(f*(n2+1)) - g*os.osc(f*(n1-1)))/(1+g^2-2*g*os.osccos(f));

envelope(trigger) = en.adsr(0.001,cperiod/3,0.4,cperiod/8,trigger);

_voice_1noteindex = cperiod : _voice_1motifnotes;

_voice_1cpitch = 110*(2^(commonPitch/12))*(2^(fineTune/1200))*(2^(-1));

_voice_1ratio_0 = 1;//(1) * (1/2) * (2^(0/1200));  //Sa'
_voice_1ratio_1 = 2;//(1) * (1) * (2^(0/1200));  //Sa
_voice_1ratio_2 = 3;//(3/2) * (1) * (2^(0/1200));  //Pa
_voice_1ratio_3 = 4;//(1) * (2) * (2^(0/1200));  //Sa"
_voice_1ratio_4 = 5;//(81/64) * (2) * (2^(0/1200));  //Ga"
_voice_1ratio_5 = 6;//(3/2) * (2) * (2^(0/1200));  //Pa"
_voice_1ratio_6 = 7;//(16/9) * (2) * (2^(0/1200));  //ni"
_voice_1ratio_7 = 8;//(2) * (2) * (2^(0/1200));  //SA"
_voice_1ratio_8 = 9;//(9/8) * (2) * (2^(0/1200));  //Re"
_voice_1ratio_9 = 10;//(81/64) * (1) * (2^(0/1200));  //Ga
_voice_1ratio_10 = 11;//(4/3) * (2) * (2^(0/1200));  //ma"
_voice_1ratio_11 = 12;//(3/2) * (1/2) * (2^(0/1200));  //Pa'
_voice_1ratio_12 = 13;//(128/81) * (2) * (2^(0/1200));  //dha"
_voice_1ratio_13 = 14;//(16/9) * (1) * (2^(0/1200));  //ni
_voice_1ratio_14 = 15;//(243/128) * (2) * (2^(0/1200));  //Ni"
_voice_1ratio_15 = 16;//(2) * (1) * (2^(0/1200));  //SA

_voice_1noteratio = _voice_1ratio_0,_voice_1ratio_1,_voice_1ratio_2,_voice_1ratio_3,_voice_1ratio_4,_voice_1ratio_5,_voice_1ratio_6,_voice_1ratio_7,_voice_1ratio_8,_voice_1ratio_9,_voice_1ratio_10,_voice_1ratio_11,_voice_1ratio_12,_voice_1ratio_13,_voice_1ratio_14,_voice_1ratio_15 : ba.selectn(16,_voice_1noteindex);
_voice_1gatewaveform = waveform{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0};

_voice_1gate(p) = _voice_1gatewaveform,int(2*ba.period(256*p*ma.SR)/(p*ma.SR)) : rdtable;
_voice_1motif = waveform{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

_voice_1motifnotes(p) = _voice_1motif,int(2*ba.period(256*p*ma.SR)/(p*ma.SR)) : rdtable;
_voice_1notes = fullstring(_voice_1cpitch,_voice_1noteratio,_voice_1noteratio+1,0.5) : *(envelope(_voice_1gate(cperiod))) : @(ma.SR*0.1);
_voice_2notes = 0;
_voice_3notes = 0;

mix(a,b) = 0.7*a+0.3*b,0.3*a+0.7*b;
concert = hgroup("[00]Motif",2*cgain*(0.7*_voice_1notes + 0.9*_voice_2notes),2*cgain*(0.7*_voice_1notes + 0.9*_voice_3notes));
process = concert : mix : dm.zita_light;
